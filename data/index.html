<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
      crossorigin="anonymous"
    ></script>

    <script src="https://unpkg.com/petite-vue" defer init></script>

    <script>
      // source: https://bobbyhadz.com/blog/javascript-convert-seconds-to-days-hours-minutes-seconds
      function toDaysMinutesSeconds(totalSeconds) {
        const seconds = Math.floor(totalSeconds % 60);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
        const days = Math.floor(totalSeconds / (3600 * 24));

        const secondsStr = makeHumanReadable(seconds, "second");
        const minutesStr = makeHumanReadable(minutes, "minute");
        const hoursStr = makeHumanReadable(hours, "hour");
        const daysStr = makeHumanReadable(days, "day");

        return `${daysStr}${hoursStr}${minutesStr}${secondsStr}`.replace(
          /,\s*$/,
          ""
        );
      }

      function makeHumanReadable(num, singular) {
        return num > 0
          ? num + (num === 1 ? ` ${singular}, ` : ` ${singular}s, `)
          : "";
      }
    </script>

    <script type="module">
      import { createApp } from "https://unpkg.com/petite-vue?module";

      function ApiLoader(props) {
        return {
          info: null,
          loadData() {
            const response = await fetch("/api/info");
            this.info = await response.json();
          },
          mounted() {
            setTimeout(() => {
              loadData();
            }, 30000);
          },
        };
      }

      createApp({
        ApiLoader,
      }).mount();
    </script>

    <title>Bedroom Clock</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1 class="mb-3">Bedroom Clock</h1>

      <section
        id="device-info"
        class="mb-3"
        v-scope="ApiLoader()"
        @vue:mounted="mounted"
      >
        <h2>Device Info</h2>
        <div>device ID: <strong class="value">%DEVICE_ID%</strong></div>
        <div>firmware version: <span class="value">%Version%</span></div>
        <div>
          wifi signal:
          <span class="value"
            >{{ info ? info.network.wifiQuality : 'n.a.' }}</span
          >
        </div>
        <div>time: <span class="value">n.a.</span></div>
        <div>
          uptime:
          <span class="value"
            >{{ info ? toDaysMinutesSeconds(info.system.uptime) : 'n.a.'
            }}</span
          >
        </div>
      </section>
    </div>
  </body>
</html>
